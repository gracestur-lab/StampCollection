"use strict";(()=>{var e={};e.id=800,e.ids=[800],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},2481:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>R,patchFetch:()=>A,requestAsyncStorage:()=>w,routeModule:()=>x,serverHooks:()=>P,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{POST:()=>S,runtime:()=>f});var i=r(9303),s=r(8716),n=r(670),o=r(4770),p=r(629),u=r.n(p),l=r(5315),m=r.n(l),d=r(7070),c=r(3493),g=r(7090);let f="nodejs";async function S(e){let t=await e.formData(),r=t.get("image"),a=String(t.get("name")??"").trim(),i=String(t.get("year")??"").trim(),s=String(t.get("faceValue")??"").trim(),n=String(t.get("theme")??"").trim();if(!(r instanceof File))return d.NextResponse.json({error:"Image file is required"},{status:400});let p=m().extname(r.name)||".jpg",l=m().basename(r.name,p).replace(/[^a-zA-Z0-9._-]/g,"_"),f=`${Date.now()}-${(0,o.randomUUID)()}-${l}${p}`,S=m().join(process.cwd(),"public","uploads");await u().mkdir(S,{recursive:!0});let x=Buffer.from(await r.arrayBuffer()),w=m().join(S,f);await u().writeFile(w,x);let h=g.Z.includes(n)?n:null,P=i?Number(i):null,R=null!==P&&Number.isInteger(P)&&P>=1800&&P<=2100?P:null,A=await c._.stamp.create({data:{name:a||l||"Untitled Stamp",year:R,faceValue:s||null,imagePath:`/uploads/${f}`,theme:h,needsReview:!0}});return await c._.ocrJob.create({data:{stampId:A.id,status:"PENDING"}}),d.NextResponse.json({ok:!0,stamp:A})}let x=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/stamps/upload/route",pathname:"/api/stamps/upload",filename:"route",bundlePath:"app/api/stamps/upload/route"},resolvedPagePath:"/Users/chloeclarke/Desktop/Stamp Collection/app/api/stamps/upload/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:h,serverHooks:P}=x,R="/api/stamps/upload/route";function A(){return(0,n.patchFetch)({serverHooks:P,staticGenerationAsyncStorage:h})}},7090:(e,t,r)=>{r.d(t,{Z:()=>a});let a=["ANIMALS","FLOWERS","HISTORICAL","ARCHITECTURE","TRANSPORT","HOLIDAYS","SPACE","SPORTS"]},3493:(e,t,r)=>{r.d(t,{_:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient({log:["error","warn"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(2481));module.exports=a})();