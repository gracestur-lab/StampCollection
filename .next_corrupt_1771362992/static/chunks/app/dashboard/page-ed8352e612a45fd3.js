(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{2424:function(e,t,l){Promise.resolve().then(l.bind(l,7447)),Promise.resolve().then(l.bind(l,4885))},7447:function(e,t,l){"use strict";l.d(t,{default:function(){return o}});var n=l(7437),a=l(7648),s=l(2265),r=l(8685);function d(e,t,l,s){return(0,n.jsxs)(a.default,{href:"/dashboard?sort=".concat(t,"&dir=").concat(l!==t?"asc":"asc"===s?"desc":"asc"),className:"inline-flex items-center gap-1 text-stampblue hover:underline",children:[e,(0,n.jsx)("span",{children:l===t?"asc"===s?"↑":"↓":""})]})}function i(e,t){return null==t?(0,n.jsxs)("span",{className:"text-xs text-stone-500",children:[e,": -"]}):(0,n.jsxs)("span",{className:"text-xs ".concat(t>=.85?"text-emerald-700":t>=.7?"text-amber-700":"text-red-700"),children:[e,": ",(100*t).toFixed(0),"%"]})}function o(e){let{stamps:t,sortBy:l,dir:a}=e,[o,c]=(0,s.useState)(t),[m,u]=(0,s.useState)(null),x=(0,s.useMemo)(()=>["",...r.Z],[]);async function p(e){if(!window.confirm("Delete this stamp?"))return;u(e);let t=await fetch("/api/stamps/".concat(e),{method:"DELETE"}),l=await t.json().catch(()=>({}));if(!t.ok){var n;window.alert(null!==(n=l.error)&&void 0!==n?n:"Delete failed"),u(null);return}c(t=>t.filter(t=>t.id!==e)),u(null)}async function h(e){var t,l,n,a,s,d,i,o;let m=null!==(l=window.prompt("Name",e.name))&&void 0!==l?l:e.name,p=null!==(a=window.prompt("Year (blank clears)",null!==(n=null===(t=e.year)||void 0===t?void 0:t.toString())&&void 0!==n?n:""))&&void 0!==a?a:"",h=null!==(d=window.prompt("Face value (blank clears)",null!==(s=e.faceValue)&&void 0!==s?s:""))&&void 0!==d?d:"",f=window.prompt("Theme (".concat(x.join(", "),") (blank clears)"),null!==(i=e.theme)&&void 0!==i?i:"");if(null==f)return;let b=p.trim()?Number(p.trim()):null;if(p.trim()&&!Number.isInteger(b)){window.alert("Year must be a whole number.");return}let j=f.trim().toUpperCase();if(j&&!r.Z.includes(j)){window.alert("Theme must match one of the taxonomy options.");return}u(e.id);let w=await fetch("/api/stamps/".concat(e.id),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:m.trim()||e.name,year:b,faceValue:h.trim()||null,theme:j||null})}),N=await w.json().catch(()=>({}));if(!w.ok){window.alert(null!==(o=N.error)&&void 0!==o?o:"Update failed"),u(null);return}c(t=>t.map(t=>t.id===e.id?N.stamp:t)),u(null)}return(0,n.jsx)("div",{className:"overflow-x-auto rounded-xl border border-stone-300 bg-white/80 shadow-sm",children:(0,n.jsxs)("table",{className:"min-w-full text-sm",children:[(0,n.jsx)("thead",{className:"border-b border-stone-300 bg-stone-100/80 text-left",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Image"}),(0,n.jsx)("th",{children:d("Name","name",l,a)}),(0,n.jsx)("th",{children:d("Year","year",l,a)}),(0,n.jsx)("th",{children:d("Face Value","faceValue",l,a)}),(0,n.jsx)("th",{children:d("Theme","theme",l,a)}),(0,n.jsx)("th",{children:"OCR Quality"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsxs)("tbody",{children:[o.map(e=>{var t,l;return(0,n.jsxs)("tr",{className:"border-b border-stone-200 last:border-b-0",children:[(0,n.jsx)("td",{children:(0,n.jsx)("img",{src:e.imagePath,alt:e.name,className:"h-14 w-20 rounded object-cover"})}),(0,n.jsx)("td",{className:"font-medium",children:e.name}),(0,n.jsx)("td",{children:null!==(t=e.year)&&void 0!==t?t:"-"}),(0,n.jsx)("td",{children:null!==(l=e.faceValue)&&void 0!==l?l:"-"}),(0,n.jsx)("td",{children:e.theme?(0,n.jsx)("span",{className:"inline-flex rounded-full border border-stampblue/40 bg-stampblue/10 px-2 py-0.5 text-xs font-medium text-stampblue",children:e.theme}):(0,n.jsx)("span",{className:"text-stone-500",children:"Unknown"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[i("Year",e.confidenceYear),i("Denom",e.confidenceFaceValue),i("Theme",e.confidenceTheme),e.needsReview?(0,n.jsx)("span",{className:"inline-flex rounded-full border border-red-300 bg-red-100 px-2 py-0.5 text-xs text-red-800",children:"needs_review"}):(0,n.jsx)("span",{className:"inline-flex rounded-full border border-emerald-300 bg-emerald-100 px-2 py-0.5 text-xs text-emerald-800",children:"trusted"})]})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>h(e),disabled:m===e.id,className:"rounded border border-stone-400 px-2 py-1 text-xs hover:bg-stone-100 disabled:opacity-60",children:"Edit"}),(0,n.jsx)("button",{type:"button",onClick:()=>p(e.id),disabled:m===e.id,className:"rounded border border-red-300 px-2 py-1 text-xs text-red-700 hover:bg-red-50 disabled:opacity-60",children:"Delete"})]})})]},e.id)}),0===o.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:7,className:"py-6 text-center text-stone-500",children:"No stamps yet. Upload an image to create one."})}):null]})]})})}},4885:function(e,t,l){"use strict";l.d(t,{default:function(){return r}});var n=l(7437),a=l(2265),s=l(8685);function r(){let[e,t]=(0,a.useState)(!1),[l,r]=(0,a.useState)(null);async function d(e){var l,n;e.preventDefault(),r(null),t(!0);let a=e.currentTarget,s=new FormData(a),d=await fetch("/api/stamps/upload",{method:"POST",body:s}),i=await d.json().catch(()=>({}));if(!d.ok){r(null!==(n=i.error)&&void 0!==n?n:"Upload failed"),t(!1);return}r("Uploaded. OCR job queued for stamp #".concat(null===(l=i.stamp)||void 0===l?void 0:l.id,".")),t(!1),a.reset(),window.location.reload()}return(0,n.jsxs)("form",{onSubmit:d,className:"grid gap-3 rounded-xl border border-stone-300 bg-white/80 p-4 shadow-sm md:grid-cols-6 md:items-end",children:[(0,n.jsxs)("label",{className:"flex flex-col gap-1 text-sm md:col-span-2",children:["Stamp Name",(0,n.jsx)("input",{name:"name",type:"text",placeholder:"Optional"})]}),(0,n.jsxs)("label",{className:"flex flex-col gap-1 text-sm",children:["Year",(0,n.jsx)("input",{name:"year",type:"number",min:1800,max:2100,placeholder:"Optional"})]}),(0,n.jsxs)("label",{className:"flex flex-col gap-1 text-sm",children:["Face Value",(0,n.jsx)("input",{name:"faceValue",type:"text",placeholder:"Optional (e.g. 25c, $1.00)"})]}),(0,n.jsxs)("label",{className:"flex flex-col gap-1 text-sm",children:["Theme",(0,n.jsxs)("select",{name:"theme",defaultValue:"",children:[(0,n.jsx)("option",{value:"",children:"Unknown"}),s.Z.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("label",{className:"flex flex-col gap-1 text-sm md:col-span-2",children:["Image",(0,n.jsx)("input",{name:"image",type:"file",accept:"image/*",required:!0,className:"file:mr-3 file:rounded file:border file:border-stone-400 file:px-2 file:py-1 file:text-sm"})]}),(0,n.jsx)("button",{type:"submit",disabled:e,className:"border-accent bg-accent text-white md:col-span-6",children:e?"Uploading...":"Upload Stamp"}),l?(0,n.jsx)("p",{className:"text-sm text-stone-700 md:col-span-6",children:l}):null]})}},8685:function(e,t,l){"use strict";l.d(t,{Z:function(){return n}});let n=["ANIMALS","FLOWERS","HISTORICAL","ARCHITECTURE","TRANSPORT","HOLIDAYS","SPACE","SPORTS"]}},function(e){e.O(0,[648,971,117,744],function(){return e(e.s=2424)}),_N_E=e.O()}]);